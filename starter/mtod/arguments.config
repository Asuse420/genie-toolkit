geniedir = ../..
bitoddir = $(geniedir)/../BiToD

NULL =
memsize := 9000
parallel := 1
NODE ?= node
genie ?= $(NODE) --experimental_worker --max_old_space_size=$(memsize) $(geniedir)/dist/tool/genie.js

all_domains = attraction hotel restaurant hkmtr weather
all_experiments = $(all_domains) multidomain

experiment ?= multidomain
# eval (dev) or test
eval_set ?= eval
dataset_file ?= $(experiment)/dataset.tt
synthetic_flags ?= \
	dialogues \
	nostream \
	notablejoin \
	projection \
	projection_with_filter \
	schema_org \
	undefined_filter \
	multiwoz \
	$(NULL)

target_pruning_size ?= 150
minibatch_size ?= 300
target_size ?= 1
subdatasets ?= 6
subdataset_ids = $(shell seq 1 $(subdatasets))
max_turns ?= 6
max_depth ?= 9

generate_flags = $(foreach v,$(synthetic_flags),--set-flag $(v)) --target-pruning-size $(target_pruning_size) --max-turns $(max_turns) --maxdepth $(max_depth)
custom_gen_flags ?=

schema_deps = $(experiment)/schema.tt $(experiment)/entities.json

restaurant_test_sets = eval test
restaurant_eval_nlu_models =
restaurant_test_nlu_models =

evalflags ?=

train_iterations ?= 50000
train_save_every ?= 2000
train_log_every ?= 100
train_pretrained_model ?= facebook/bart-large
train_nlu_flags ?= \
	--model TransformerSeq2Seq \
	--pretrained_model $(train_pretrained_model) \
	--gradient_accumulation_steps 20 \
	--preprocess_special_tokens
custom_train_nlu_flags ?=